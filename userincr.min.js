(function(e){e.fn.userincr=function(c){c=e.extend({},e.fn.userincr.defaults,c||{});return this.each(function(){var b=e(this),l=b.val(),f="b";b.attr("title",b.attr("title")||'Enter "+x" or "+x%" or "*x" \nto change increment'+e.map(c.constants,function(a,b){return"\n"+b+"="+a}).join("")).on("change",function(a){a=b.val();if(void 0!==c.constants[a])b.val(c.constants[a]);else if("%"==a.substr(-1))a=parseFloat(a.substr(0,a.length-1)),0<a?d("mul",1+a/100,"i"):d("mul",1/(1+a/100),"d");else{var g=a.substr(0,
1);a=parseFloat(a.substr(1));"-"===g&&0<=b.data("min")?d("add",a,"d"):"+"==g?0>a?d("add",-a,"d"):d("add",a,"i"):"*"==g?1<a?d("mul",a,"i"):d("mul",1/a,"d"):"/"==g?1<a?d("mul",a,"d"):d("mul",1/a,"i"):(m(),"b"==f&&h[1].focus())}});if(c.kbd)b.on("keydown",function(a){var b;if(38==a.keyCode)b="i";else if(40==a.keyCode)b="d";else return;k(b,"k");a.preventDefault()});if(c.wheel)b.on("wheel",function(a){k(0>a.originalEvent.wheelDeltaY?"d":"i","w");a.preventDefault()});var m=function(){var a=b.data("min"),
c=parseFloat(b.val());e.isNumeric(a)&&c<a&&(c=a);a=b.data("max");e.isNumeric(a)&&c>a&&(c=a);l=c;b.val(c)},d=function(a,e,d){b.data("op",a).data("step",e);["dec","inc"].forEach(function(a,d){h[d].attr({title:c.ops[b.data("op")][a+"fmt"](b.data("step"))})});void 0!==d&&k(d)},k=function(a,d){b.val(c.ops[b.data("op")][a](parseFloat(l),b.data("step")));m();f=d||f;"b"==f&&h["d"===a?0:1].focus();b.trigger("step")},h=e.map(["dec","inc"],function(a){return e("<input>",{type:"button",value:c.buttons[a],"class":"userincr-btn-"+
a}).on("click",function(){k(a.substr(0,1),"b")})});d(b.data("op")||"add",b.data("step")||1);1!=b.parent().children().length&&b.wrap('<span class="userincr-container">');b.parent().append(h)})};e.fn.userincr.defaults={buttons:{dec:"\u25bc",inc:"\u25b2"},constants:{},ops:{add:{i:function(c,b){return c+b},incfmt:function(c){return"+"+c},d:function(c,b){return c-b},decfmt:function(c){return"\u2212"+c}},mul:{i:function(c,b){return c*b},incfmt:function(c){return"\u00d7"+c},d:function(c,b){return c/b},decfmt:function(c){return"\u00f7"+
c}}}}})(jQuery);
