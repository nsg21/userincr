(function(d){d.fn.userincr=function(c){c=d.extend({},d.fn.userincr.defaults,c||{});return this.each(function(){var b=d(this);b.data("value",c.value||b.data("value")||b.val()||0);b.val(b.data("value"));d.each(["min","max","step","op","previous"],function(a,e){void 0!==c[e]&&b.data(e,c[e])});var h="b";b.attr("title",b.attr("title")||'Enter "+x" or "+x%" or "*x" \nto change increment'+d.map(c.constants,function(a,b){return"\n"+b+"="+a}).join("")).on("change",function(a){a=b.val();if(void 0!==c.constants[a])b.val(c.constants[a]);
else if("%"==a.substr(-1))a=parseFloat(a.substr(0,a.length-1)),0<a?f("mul",1+a/100,"i"):f("mul",1/(1+a/100),"d");else{var e=a.substr(0,1);a=parseFloat(a.substr(1));"-"===e&&0<=b.data("min")?f("add",a,"d"):"+"==e?0>a?f("add",-a,"d"):f("add",a,"i"):"*"==e?1<a?f("mul",a,"i"):f("mul",1/a,"d"):"/"==e?1<a?f("mul",a,"d"):f("mul",1/a,"i"):(l(),"b"==h&&k[1].focus())}});if(c.kbd)b.on("keydown",function(a){var b;if(38==a.keyCode)b="i";else if(40==a.keyCode)b="d";else return;g(b,"k");a.preventDefault()});if(c.wheel)b.on("wheel",
function(a){g(0>a.originalEvent.wheelDeltaY?"d":"i","w");a.preventDefault()});var l=function(){var a=b.data("min"),c=parseFloat(b.val());d.isNumeric(a)&&c<a&&(c=a);a=b.data("max");d.isNumeric(a)&&c>a&&(c=a);b.data("previous",b.data("value"));b.data("value",c);b.val(c)},f=function(a,e,d){b.data("op",a).data("step",e);["dec","inc"].forEach(function(a,d){k[d].attr({title:c.ops[b.data("op")][a+"fmt"](b.data("step"))})});void 0!==d&&g(d)},g=function(a,d){b.val(c.ops[b.data("op")][a](parseFloat(b.data("value")),
b.data("step")));l();h=d||h;"b"==h&&k["d"===a?0:1].focus();b.trigger("step")};b.data("spin",g);var k=d.map(["dec","inc"],function(a){return d("<input>",{type:"button",value:c.buttons[a],"class":"userincr-btn-"+a}).on("click",function(){g(a.substr(0,1),"b")})});f(b.data("op")||"add",b.data("step")||1);1!=b.parent().children().length&&b.wrap('<span class="userincr-container">');b.parent().append(k)})};d.fn.userincr.defaults={buttons:{dec:"\u25bc",inc:"\u25b2"},constants:{},ops:{add:{i:function(c,b){return c+
b},incfmt:function(c){return"+"+c},d:function(c,b){return c-b},decfmt:function(c){return"\u2212"+c}},mul:{i:function(c,b){return c*b},incfmt:function(c){return"\u00d7"+c},d:function(c,b){return c/b},decfmt:function(c){return"\u00f7"+c}}}}})(jQuery);
